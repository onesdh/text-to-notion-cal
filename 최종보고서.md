# 텍스트를 Notion 캘린더로: 최종 보고서

## 1. 기능 요약

본 프로젝트는 자연어 텍스트로 입력된 일정 정보를 분석하여 Notion 데이터베이스에 자동으로 등록하는 MCP(Multi-tool Co-operative Protocol) 기반의 툴입니다.

### 주요 기술 스택
- **언어 및 프레임워크**: Python, FastMCP, Uvicorn
- **AI/LLM**: Langchain, LangGraph, OpenAI API
- **데이터베이스 및 API**: Notion API

### 핵심 기능 및 워크플로우
1.  **MCP 서버**: `gemini` CLI와 같은 클라이언트가 연결하여 사용할 수 있는 `add_event_to_notion` 툴을 제공합니다.
2.  **LangGraph 기반 워크플로우**: 상태(State)를 기반으로 아래의 3단계 노드를 순차적으로 실행하여 안정적인 처리를 보장합니다.
    -   **`init_notion_schema`**: 사용자가 지정한 Notion 데이터베이스에 `Name`, `Date`, `Description` 속성이 있는지 확인하고, 없을 경우 자동으로 생성하여 초기 설정의 번거로움을 줄입니다.
    -   **`extract_event`**: OpenAI의 LLM을 사용하여 입력된 텍스트에서 하나 이상의 일정(제목, 시작/종료 시간, 설명)을 정확하게 추출하고 구조화된 데이터(JSON)로 변환합니다.
    -   **`add_to_notion`**: 추출된 일정 정보를 바탕으로 Notion API를 호출하여 데이터베이스에 새로운 페이지(일정)를 생성합니다.
3.  **Pydantic 모델링**: 워크플로우의 각 단계에서 사용되는 데이터 구조(State, Config, Event)를 명확하게 정의하여 데이터의 일관성과 안정성을 확보했습니다.

---

## 2. 프로젝트 회고

### 긍정적인 점

-   **LangGraph의 성공적인 도입**: 일정 처리 과정을 '스키마 검증 → 정보 추출 → Notion 등록'이라는 명확한 그래프 구조로 설계함으로써, 복잡한 로직을 체계적이고 모듈화하여 관리할 수 있었습니다. 각 노드의 역할을 분리하여 디버깅과 기능 확장이 용이해졌습니다.
-   **사용자 경험(UX)을 고려한 자동화**: `init_notion_schema` 노드를 통해 사용자가 Notion 데이터베이스 속성을 수동으로 설정해야 하는 부담을 없앴습니다. 이는 사용자가 툴을 더 빠르고 쉽게 도입할 수 있게 하는 중요한 기능이었습니다.
-   **MCP를 통한 툴의 재사용성 확보**: 기능을 독립적인 MCP 서버로 구현함으로써, 특정 애플리케이션에 종속되지 않는 범용적인 툴을 만들 수 있었습니다. `gemini` CLI 등 다양한 클라이언트에서 `@` 호출만으로 쉽게 기능을 사용할 수 있어 확장성이 뛰어납니다.

### 아쉬운 점

-   **단방향 소통의 한계**: 현재 시스템은 사용자의 텍스트를 받아 일정을 '생성'하는 단방향 기능만 제공합니다. 사용자의 입력이 "내일 회의"처럼 시간이 명확하지 않을 때, 시스템이 "몇 시에 진행할까요?"라고 되묻는 **상호작용 기능이 부재**하여 사용성이 제한됩니다.
-   **생성된 일정 관리 기능 부재**: 일정을 한 번 생성하면 끝입니다. "방금 만든 회의 취소해줘" 또는 "마케팅 미팅 1시간 뒤로 미뤄줘"와 같이 이미 생성된 **Notion 캘린더의 일정을 수정하거나 삭제하는 기능이 없어** 실제 사용 환경에서는 불편함이 따릅니다.
-   **고정된 데이터베이스 스키마**: 현재 시스템은 Notion 데이터베이스의 속성을 `Name`, `Date`, `Description`으로 고정하고 있습니다. 사용자가 '제목'이나 '날짜'와 같이 다른 이름의 속성을 사용하거나 '태그', '참석자' 같은 추가 정보를 저장하고 싶을 경우, 이를 지원하지 않아 유연성이 떨어집니다.

---

## 3. 한계점

1.  **상태 비저장 구조**: 각 요청이 독립적으로 처리되므로 이전 대화의 맥락을 기억하지 못합니다. 이로 인해 "방금 만든 일정을 수정해줘"와 같은 연속적인 명령을 이해하고 처리하는 것이 근본적으로 불가능합니다. 이는 일정 수정/삭제 기능 부재의 직접적인 원인이 됩니다.
2.  **LLM의 환각 및 해석 오류**: LLM은 때때로 날짜나 시간을 잘못 해석하거나, 사용자의 의도와 다른 내용으로 일정을 생성할 수 있습니다. 예를 들어 "다음 주 수요일"을 잘못된 날짜로 인식할 수 있으며, 현재 시스템에는 이를 교차 검증할 장치가 없습니다.
3.  **외부 API 및 네트워크 의존성**: OpenAI와 Notion API의 상태에 전적으로 의존합니다. 특정 API 서버가 다운되거나 네트워크 지연이 발생하면 서비스 전체가 중단되는 취약점을 가지고 있습니다.

---

## 4. 향후 개선 방향

1.  **대화형 일정 관리 기능 구현 (수정/삭제)**:
    -   LangGraph의 `Checkpointer`를 도입하여 대화 스레드별로 상태(생성된 Notion 페이지 ID 등)를 영속적으로 저장합니다.
    -   사용자의 후속 요청이 '수정' 또는 '삭제' 의도를 가질 경우, 저장된 상태를 참조하여 Notion API의 페이지 업데이트/삭제 기능을 호출하는 새로운 노드를 워크플로우에 추가합니다.
2.  **양방향 소통을 위한 상호작용 도입**:
    -   `extract_event` 노드에서 필수 정보(제목, 시간)가 누락된 경우, 워크플로우를 `END`로 보내는 대신 '정보 확인 요청' 상태로 전환합니다.
    -   LangGraph의 `interrupt_before` 기능을 활용하여 워크플로우를 일시 중지하고, 사용자에게 추가 정보를 입력받아 워크플로우를 재개하는 로직을 구현합니다.
3.  **유연한 데이터베이스 스키마 매핑 기능**:
    -   사용자가 `.env` 파일이나 별도의 설정 파일에 자신의 데이터베이스 속성 이름(예: `TITLE_PROPERTY=제목`, `DATE_PROPERTY=날짜`)을 매핑할 수 있도록 기능을 확장합니다.
    -   `init_notion_schema`와 `add_to_notion` 노드가 이 설정 값을 읽어 동적으로 속성을 처리하도록 로직을 수정합니다.

---
